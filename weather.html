<html>
<body>
  <div>
    <h4><a href="https://github.com/ddboline/weather_api_rust">The Weather</a></h4>
    Returns the current weather and forecast for the next 5 days, default location is NYC, press the button to use your current location.
    The app uses the <a href="https://crates.io/crates/weather_util_rust">weather_util_rust</a> library
    which pulls data from <a href="https://openweathermap.org/">openweathermap.org</a> and adds caching.
    <br><br>
    <input type="button" name="update_location" value="Update Location" onclick="updateLocation();"/>
    <br>
    <iframe src="https://cloud.ddboline.net/weather/plot.html?zip=10001" id="weather-frame" height="100" width="100" align="center"></iframe>
    <script>
      !function() {
        let textarea = document.getElementById('weather-frame');
        if (textarea) {
          if (textarea.getAttribute('height')) {
            textarea.setAttribute('height', Math.floor(window.innerHeight * 650 / 856.));
          }
          if (textarea.getAttribute('width')) {
            textarea.setAttribute('width', Math.floor(window.innerWidth * 850 / 1105.));
          }
        }
      }();
      function updateLocation() {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(
          function success(position) {
            console.log("Got position " + position.coords.latitude + " " + position.coords.longitude);
            let url = "https://cloud.ddboline.net/weather/plot.html?lat=" + position.coords.latitude + "&lon=" + position.coords.longitude;
            console.log("url " + url);
            let weather = document.getElementById("weather-frame");
            if (weather) {
                weather.src = url;
                if (weather.contentDocument) {
                    weather.contentDocument.location.reload(true);
                }
            }
          },
          function error(error_message) {
            // for when getting location results in an error
            console.error('No location retreived', error_message)
          });
        }
      }
    </script>
  </div>
</body>
